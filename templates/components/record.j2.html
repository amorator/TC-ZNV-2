<!DOCTYPE html>
<html lang="ru" data-theme="{{ request.args.get('theme', 'light') }}" class="theme-{{ request.args.get('theme', 'light') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Запись файлов</title>
    <link rel="icon" type="image/png" href="/static/images/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/static/images/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/static/images/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/static/images/favicon/site.webmanifest" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/progress.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/record.css') }}">
  <script>
    // Apply theme ASAP based on URL param before deferred scripts
    (function(){
      try {
        var params = new URLSearchParams(location.search);
        var t = params.get('theme');
        if (t) {
          document.documentElement.setAttribute('data-theme', t);
          document.body && document.body.setAttribute('data-theme', t);
          var cls = document.documentElement.className || '';
          cls = cls.replace(/\btheme-[\w-]+\b/g, '').trim();
          document.documentElement.className = (cls + ' theme-' + t).trim();
        }
      } catch(e) {}
    })();
  </script>
    <style>
      /* Ensure proper theming for iframe using theme tokens directly (as in backup) */
      html, body {
        background-color: var(--modal-bg, var(--body-bg, #ffffff)) !important;
        color: var(--body-text, #000000) !important;
        margin: 0 !important;
        padding: 0 !important;
        min-height: 100vh !important;
        height: 100% !important;
        overflow-y: hidden !important; /* default: no vertical scrollbar */
      }
      /* Add spacing between video blocks and menu content */
      .record-page__videos { margin-right: 20px !important; }
    </style>
</head>
<body data-theme="{{ request.args.get('theme', 'light') }}" class="theme-{{ request.args.get('theme', 'light') }}" style="background-color: var(--modal-bg, var(--body-bg, #ffffff)) !important; min-height: 100vh;">
<section class="record-page">
  {% if request.args.get('embed') != '1' %}
  <h1 class="record-page__title">Запись файлов</h1>
  {% endif %}
  <div class="record-page__body">
    <div class="record-page__videos">
      <div class="record-page__video">
        <span class="record-page__video-label">Экран</span>
        <video class="video" autoplay playsinline id="video-screen"></video>
      </div>
      <div class="record-page__video">
        <span class="record-page__video-label">Камера</span>
        <video class="video" autoplay playsinline id="video-camera"></video>
      </div>
      <div class="record-page__video" id="audio-indicator-wrap" style="display:none;">
        <span class="record-page__video-label">Микрофон</span>
        <div id="audio-indicator" class="audio-indicator" aria-label="Индикатор аудио"></div>
      </div>
    </div>
    <div class="record-page__menu">
      <div class="record-page__pult">
        <div class="record-page__source-selection">
          <label class="record-page__source-label">
            <input type="radio" name="source" value="camera" id="source-camera" checked>
            <span>Только камера</span>
          </label>
          <label class="record-page__source-label">
            <input type="radio" name="source" value="screen" id="source-screen">
            <span>Только экран</span>
          </label>
          <label class="record-page__source-label">
            <input type="radio" name="source" value="both" id="source-both">
            <span>Экран + камера</span>
          </label>
          <label class="record-page__source-label">
            <input type="radio" name="source" value="audio" id="source-audio">
            <span>Только аудио</span>
          </label>
        </div>
        <button class="button" id="camera">Включить камеру</button>
        <button class="button" id="start">Начать запись</button>
        <button class="button" id="pause">Пауза</button>
        <button class="button" id="stop">Стоп</button>
      </div>
      <div class="record-page__settings">
        <div class="record-page__settings-time record-page__setting">
          <span class="record-page__setting-title">Длина записи:</span>
          <span class="record-page__setting-element" id="time">00:00:00</span>
        </div>
        <div class="record-page__settings-file-name record-page__setting">
          <label class="record-page__setting-title" for="name">Название файла:</label>
          <input
            class="record-page__setting-element"
            type="text"
            id="name"
            name="name"
            placeholder="Video"
            required
            autocomplete="off"
          />
        </div>
        <div class="record-page__settings-description record-page__setting">
          <label class="record-page__setting-title" for="desc">Описание:</label>
          <textarea
            class="record-page__setting-element"
            id="desc"
            name="desc"
            placeholder="Не обязательно..."
            autocomplete="off"
          ></textarea>
        </div>
        <button class="button" id="save">Сохранить</button>
        <input style="display: none" value="{{ did }}" id="did" />
        <input style="display: none" value="{{ sdid }}" id="sdid" />
        <div class="progress" id="uploadProgress" style="display:none;">
          <div class="progress-bar" id="uploadProgressBar" role="progressbar" style="width:0%"></div>
        </div>
        <div class="upload__container" style="display:none;">
          <span class="upload__status" id="uploadForm_Status"></span>
          <span id="uploadForm_Size"></span>
        </div>
      </div>
    </div>
  </div>
</section>

{% block js %}
<script src="{{ url_for('static', filename='js/record.js') }}" defer="defer"></script>
{% endblock %}
</body>
</html>
